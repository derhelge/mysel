server inner-tunnel {
listen {
       ipaddr = 127.0.0.1
       port = 18120
       type = auth
}
authorize {
	filter_username
	# The outer username is considered garabage for autz purposes, but 
	# the domain portion of the outer and inner identities must match.
	split_username_nai
	if (noop || (&Stripped-User-Domain && \
		(&outer.Stripped-User-Domain != &Stripped-User-Domain))) {
		reject
	}

	# Make the user's real identity available to anything that needs
	# it in the outer server.
	if (&outer.session-state:)
		update {
			&outer.session-state:User-Name := &User-Name
		}
	}

	sql
	pap
}
authenticate {
	pap
}
post-auth {
	# f√ºr logging
	update outer.session-state {
		&User-Name := &User-Name
	}

	# logging
	Post-Auth-Type REJECT {
		update outer.session-state {
			&User-Name := &User-Name
		}
	}
}
} # inner-tunnel server block
